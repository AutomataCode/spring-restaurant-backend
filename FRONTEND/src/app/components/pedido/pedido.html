<div class="pedido-container">
  <!-- Header Minimalista -->
  <header class="pedido-header">
    <div class="header-content">
      <button class="back-btn" (click)="goToMenu()">‚Üê Volver</button>
      <div class="breadcrumb">
        <span>Carrito</span>
        <span class="breadcrumb-separator">></span>
        <span class="breadcrumb-active">Pedido</span>
      </div>
    </div>
  </header>

  <!-- Main Content - Layout de dos columnas -->
  <div class="pedido-content-wrapper">
    <!-- Columna Izquierda - Formulario -->
    <div class="pedido-content">
    <!-- Formulario de Pedido -->
    @if (!showSuccess) {
      <form (ngSubmit)="onSubmit()" class="pedido-form">
          <!-- Tipo de Pedido -->
          <div class="form-section">
            <div class="section-header">
              <div class="section-icon">üìç</div>
              <h2 class="section-title">Tipo de Pedido</h2>
            </div>
            <div class="radio-group">
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="tipoPedido" 
                  value="DOMICILIO"
                  [(ngModel)]="pedidoForm.tipoPedido">
                <div class="radio-content">
                  <span class="radio-icon">üöö</span>
                  <div class="radio-text-group">
                    <span class="radio-text">Domicilio</span>
                    <span class="radio-subtext">Entrega a tu direcci√≥n</span>
                  </div>
                  <span class="radio-custom"></span>
                </div>
              </label>
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="tipoPedido" 
                  value="LOCAL"
                  [(ngModel)]="pedidoForm.tipoPedido">
                <div class="radio-content">
                  <span class="radio-icon">üè™</span>
                  <div class="radio-text-group">
                    <span class="radio-text">Local</span>
                    <span class="radio-subtext">Recoger en el restaurante</span>
                  </div>
                  <span class="radio-custom"></span>
                </div>
              </label>
            </div>
          </div>

          <!-- Informaci√≥n de Entrega -->
          <div class="form-section">
            <div class="section-header">
              <div class="section-icon">üìã</div>
              <h2 class="section-title">Informaci√≥n de Entrega</h2>
            </div>
            
            @if (pedidoForm.tipoPedido === 'DOMICILIO') {
              <div class="form-group">
                <label for="direccion">Direcci√≥n de Entrega *</label>
                <textarea 
                  id="direccion"
                  [(ngModel)]="pedidoForm.direccionEntrega"
                  name="direccionEntrega"
                  rows="3"
                  placeholder="Ingrese su direcci√≥n completa"
                  required></textarea>
              </div>

              <div class="form-group">
                <label for="instrucciones">Instrucciones de Entrega</label>
                <textarea 
                  id="instrucciones"
                  [(ngModel)]="pedidoForm.instruccionesEntrega"
                  name="instruccionesEntrega"
                  rows="2"
                  placeholder="Referencias, indicaciones, etc."></textarea>
              </div>
            }

            <div class="form-group">
              <label for="telefono">Tel√©fono de Contacto *</label>
              <input 
                type="tel"
                id="telefono"
                [(ngModel)]="pedidoForm.telefonoContacto"
                name="telefonoContacto"
                placeholder="999 999 999"
                required>
            </div>
          </div>

          <!-- M√©todo de Pago -->
          <div class="form-section">
            <div class="section-header">
              <div class="section-icon">üí≥</div>
              <h2 class="section-title">M√©todo de Pago</h2>
            </div>
            <div class="radio-group">
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="metodoPago" 
                  value="EFECTIVO"
                  [(ngModel)]="pedidoForm.metodoPago">
                <div class="radio-content">
                  <span class="radio-icon">üíµ</span>
                  <div class="radio-text-group">
                    <span class="radio-text">Efectivo</span>
                    <span class="radio-subtext">Pago al recibir</span>
                  </div>
                  <span class="radio-custom"></span>
                </div>
              </label>
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="metodoPago" 
                  value="YAPE"
                  [(ngModel)]="pedidoForm.metodoPago">
                <div class="radio-content">
                  <span class="radio-icon">üíö</span>
                  <div class="radio-text-group">
                    <span class="radio-text">Yape</span>
                    <span class="radio-subtext">Pago digital</span>
                  </div>
                  <span class="radio-custom"></span>
                </div>
              </label>
            </div>

            @if (pedidoForm.metodoPago === 'EFECTIVO') {
              <div class="form-group">
                <label for="cambioPara">Cambio para (S/) *</label>
                <input 
                  type="number"
                  id="cambioPara"
                  [(ngModel)]="pedidoForm.cambioPara"
                  name="cambioPara"
                  step="0.01"
                  min="0"
                  placeholder="0.00"
                  required>
              </div>
            }

            @if (pedidoForm.metodoPago === 'YAPE' && yapeConfig) {
              <div class="yape-info-box">
                <div class="yape-header">
                  <h3>üíö Pago con Yape</h3>
                </div>
                <div class="yape-content">
                  <div class="yape-code-section">
                    <p class="yape-label">C√≥digo Yape:</p>
                    <p class="yape-number">{{ yapeConfig.codigo }}</p>
                    @if (yapeConfig.qrUrl) {
                      <div class="qr-image-container">
                        <img [src]="yapeConfig.qrUrl" alt="C√≥digo QR Yape" class="qr-image" (error)="onQrImageError($event)">
                      </div>
                    }
                  </div>
                  <div class="yape-number-section">
                    <p class="yape-label">N√∫mero Yape:</p>
                    <p class="yape-number">{{ yapeConfig.numero }}</p>
                  </div>
                  <div class="yape-instructions">
                    <p class="instructions-title">üì± Instrucciones:</p>
                    <ol class="instructions-list">
                      <li>Realiza el pago a este c√≥digo Yape</li>
                      <li>Env√≠a la captura de pantalla al n√∫mero:</li>
                      <li class="whatsapp-number">
                        <a [href]="'https://wa.me/' + yapeConfig.whatsapp" target="_blank" class="whatsapp-link">
                          üì± {{ yapeConfig.whatsapp }}
                        </a>
                      </li>
                      <li>Tu pedido ser√° confirmado despu√©s de verificar el pago</li>
                    </ol>
                  </div>
                  <div class="yape-warning">
                    ‚ö†Ô∏è Tu pedido quedar√° en espera hasta confirmar el pago
                  </div>
                </div>
              </div>
            }
          </div>


          <!-- Error Message -->
          @if (errorMessage) {
            <div class="error-message">
              {{ errorMessage }}
            </div>
          }

          <!-- Submit Button -->
          <div class="submit-section">
            <button 
              type="submit" 
              class="submit-btn whatsapp-btn"
              [disabled]="isLoading">
              <div class="btn-content">
                @if (isLoading) {
                  <span class="spinner-small"></span>
                  <span>Procesando...</span>
                } @else {
                  <span class="whatsapp-icon-btn">üí¨</span>
                  <span>Enviar Pedido por WhatsApp</span>
                  <span class="btn-arrow">‚Üí</span>
                }
              </div>
              <div class="btn-shine"></div>
            </button>
            <p class="whatsapp-info">
              <span class="info-icon">‚ÑπÔ∏è</span>
              Al confirmar, se abrir√° WhatsApp con tu pedido listo para enviar
            </p>
          </div>
        </form>
    }

    <!-- Pedido Creado Exitosamente -->
    @if (showSuccess && pedidoCreado) {
      <div class="success-section" id="pedido-resultado">
        <div class="success-animation">
          <div class="success-icon-wrapper">
            <div class="success-icon">‚úÖ</div>
            <div class="success-rings"></div>
            <div class="success-rings"></div>
          </div>
        </div>
        <h2 class="success-title">¬°Pedido Listo para Enviar!</h2>
        <p class="success-message">Se ha abierto WhatsApp con tu pedido. Env√≠a el mensaje a la tienda para confirmar tu orden.</p>
        <div class="whatsapp-status">
          <div class="status-icon">üí¨</div>
          <div class="status-text">
            <strong>WhatsApp abierto</strong>
            <span>Revisa tu aplicaci√≥n de WhatsApp</span>
          </div>
        </div>

        <div class="pedido-details">
          <div class="detail-card">
            <h3>Detalles del Pedido</h3>
            <div class="detail-item">
              <span class="detail-label">N√∫mero de Pedido:</span>
              <span class="detail-value">#{{ pedidoCreado.id }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Tipo:</span>
              <span class="detail-value">{{ pedidoCreado.tipoPedido }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Estado:</span>
              <span class="detail-value status-badge" [class]="'status-' + pedidoCreado.estado.toLowerCase()">
                {{ pedidoCreado.estado }}
              </span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Total:</span>
              <span class="detail-value total-highlight">S/ {{ pedidoCreado.total.toFixed(2) }}</span>
            </div>
            @if (pedidoCreado.direccionEntrega) {
              <div class="detail-item">
                <span class="detail-label">Direcci√≥n:</span>
                <span class="detail-value">{{ pedidoCreado.direccionEntrega }}</span>
              </div>
            }
            <div class="detail-item">
              <span class="detail-label">M√©todo de Pago:</span>
              <span class="detail-value">{{ pedidoCreado.metodoPago }}</span>
            </div>
          </div>

          @if (pedidoCreado.detalles && pedidoCreado.detalles.length > 0) {
            <div class="detail-card">
              <h3>Items del Pedido</h3>
              @for (detalle of pedidoCreado.detalles; track detalle.id) {
                <div class="detalle-item">
                  <div class="detalle-info">
                    <h4>{{ detalle.platoNombre || 'Plato' }}</h4>
                    <p>Cantidad: {{ detalle.cantidad }} √ó S/ {{ detalle.precioUnitario }}</p>
                  </div>
                  <div class="detalle-subtotal">
                    S/ {{ detalle.subtotal.toFixed(2) }}
                  </div>
                </div>
              }
            </div>
          }
        </div>

        <div class="success-actions">
          <button class="action-btn primary" (click)="goToPedidos()">
            Ver Mis Pedidos
          </button>
          <button class="action-btn secondary" (click)="goToMenu()">
            Seguir Comprando
          </button>
        </div>
      </div>
    }
    </div>

    <!-- Columna Derecha - Resumen del Pedido (Sticky) -->
    @if (!showSuccess) {
      <aside class="order-summary">
        <div class="summary-header">
          <h2>Resumen del Pedido</h2>
        </div>
        
        <div class="summary-items">
          @for (item of cartItems; track item.plato.id) {
            <div class="summary-item">
              <div class="summary-item-image">
                <div class="item-image-placeholder">{{ item.plato.nombre.charAt(0) }}</div>
              </div>
              <div class="summary-item-details">
                <h4>{{ item.plato.nombre }}</h4>
                <div class="summary-item-meta">
                  <span>{{ item.cantidad }}x</span>
                  <span>S/ {{ item.plato.precio.toFixed(2) }}</span>
                </div>
              </div>
              <div class="summary-item-price">
                S/ {{ item.subtotal.toFixed(2) }}
              </div>
            </div>
          }
        </div>

        <div class="summary-totals">
          <div class="summary-row">
            <span>Subtotal</span>
            <span>S/ {{ totalPrice.toFixed(2) }}</span>
          </div>
          <div class="summary-row">
            <span>Env√≠o</span>
            <span class="free-shipping">GRATIS</span>
          </div>
          <div class="summary-row summary-total">
            <span>Total</span>
            <span class="total-amount">S/ {{ totalPrice.toFixed(2) }}</span>
          </div>
        </div>

        <div class="whatsapp-note">
          <div class="whatsapp-icon">üí¨</div>
          <p>Tu pedido se enviar√° por WhatsApp</p>
        </div>
      </aside>
    }
  </div>
</div>

